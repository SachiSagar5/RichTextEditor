
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Rich Text Editor with Multi-Tab Support and LocalStorage Persistence" />
  <meta name="author" content="Sachin R" />
  <meta name="version" content="1.0.0" />
  <title>Rich Editor ‚Äî Multi-Tab</title>

  <style>
    :root{
      --bg:#f4f6f8; --panel:#ffffff; --muted:#6b7280; --accent:#1976d2;
      --radius:10px; --toolbar-h:56px;
    }
    html,body{height:100%; margin:0; font-family: Inter, "Segoe UI", Roboto, Arial; -webkit-font-smoothing:antialiased}
    body{background:linear-gradient(180deg,#eef2ff 0%,var(--bg) 100%); color:#111827; padding:18px; box-sizing:border-box}

    .app {
      max-width:1200px; margin:0 auto; background:var(--panel); border-radius:12px; box-shadow:0 12px 40px rgba(2,6,23,0.08);
      overflow: hidden; display:flex; flex-direction:column; min-height:78vh;
    }

    header.appbar{
      height:var(--toolbar-h); display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px 16px;
      background:linear-gradient(180deg,#fff,#f7fbff); border-bottom:1px solid rgba(15,23,42,0.04);
    }
    .brand { display:flex; gap:12px; align-items:center; }
    .logo { width:36px; height:36px; border-radius:8px; background:linear-gradient(135deg,#1976d2,#42a5f5); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; font-size:16px; }
    h1 { font-size:16px; margin:0; color:var(--accent) }
    .small{font-size:12px;color:var(--muted)}

    .toolbar { display:flex; gap:8px; align-items:center; }
    .tb-btn { background:transparent; border:1px solid rgba(15,23,42,0.06); padding:8px; border-radius:8px; cursor:pointer; display:inline-flex; align-items:center; gap:8px; font-size:14px; }
    .tb-btn:hover { background:rgba(25,118,210,0.06) }
    .primary { background:var(--accent); color:#fff; border-color:transparent }

    .tabs {
      display:flex; gap:8px; padding:10px; background:linear-gradient(180deg,#f7f8fb,#f0f3f7); overflow:auto;
      border-bottom:1px solid rgba(15,23,42,0.03);
    }
    .tab { background:transparent; border:1px solid transparent; padding:8px 12px; border-radius:8px; cursor:pointer; white-space:nowrap; display:flex; gap:8px; align-items:center; }
    .tab.active { background:var(--panel); border-color:rgba(25,118,210,0.12); box-shadow:0 6px 14px rgba(37,99,235,0.06) }

    .main { display:flex; gap:16px; padding:16px; flex:1; align-items:stretch }
    .left { flex:1; display:flex; flex-direction:column; gap:12px }
    .editor {
      flex:1; border-radius:8px; background:var(--panel); padding:18px; box-shadow:inset 0 0 0 1px rgba(15,23,42,0.03);
      min-height:360px; outline:none; overflow:auto;
    }
    .side {
      width:300px; min-width:220px; background:linear-gradient(180deg,#fff,#fbfdff); border-radius:8px; padding:12px; border:1px solid rgba(15,23,42,0.04)
    }

    .control-row { display:flex; gap:8px; align-items:center; margin-bottom:8px }
    .select, .input { padding:8px 10px; border-radius:8px; border:1px solid rgba(15,23,42,0.06) }

    footer { padding:10px 16px; border-top:1px solid rgba(15,23,42,0.04); display:flex; justify-content:space-between; align-items:center; background:#fff }

    @media (max-width:920px){
      .main{flex-direction:column}
      .side{width:100%}
    }
  </style>
</head>
<body>

<div class="app" role="application" aria-label="Rich editor app">
  <header class="appbar">
    <div class="brand">
      <div class="logo">RE</div>
      <div>
        <h1>Rich Editor</h1>
        <div class="small">Multi-Tab ‚Ä¢ Local images ‚Ä¢ Tables ‚Ä¢ Compressed save</div>
      </div>
    </div>

    <div style="display:flex;gap:10px;align-items:center">
      <div class="toolbar" role="toolbar" aria-label="Formatting toolbar">
        <button class="tb-btn" id="boldBtn" title="Bold (Ctrl/Cmd+B)"><strong>B</strong></button>
        <button class="tb-btn" id="italicBtn" title="Italic (Ctrl/Cmd+I)"><em>I</em></button>
        <button class="tb-btn" id="underlineBtn" title="Underline (Ctrl/Cmd+U)"><u>U</u></button>
        <button class="tb-btn" id="strikeBtn" title="Strike"><s>S</s></button>
        <button class="tb-btn" id="bulletedBtn" title="Bulleted list">‚Ä¢ List</button>
        <button class="tb-btn" id="numberedBtn" title="Numbered list">1. List</button>

        <!-- color pickers -->
        <input id="colorPicker" type="color" title="Text color" style="border:none;padding:0" />
        <input id="bgColorPicker" type="color" title="Highlight color" style="border:none;padding:0" />

        <!-- image and table -->
        <input id="imgInput" type="file" accept="image/*" style="display:none" />
        <button class="tb-btn" id="imgBtn" title="Insert local image">üñºÔ∏è Image</button>
        <button class="tb-btn" id="tableBtn" title="Insert table">üî≤ Table</button>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button class="tb-btn primary" id="saveBtn" title="Save (compress & store)">üíæ Save</button>
        <button class="tb-btn" id="clearBtn" title="Clear all saved notes">üóëÔ∏è Clear Notes</button>
      </div>
    </div>
  </header>

  <div class="tabs" id="tabsBar" role="tablist"></div>

  <div class="main">
    <div class="left">
      <div id="editor" class="editor" contenteditable="true" spellcheck="true" aria-multiline="true"></div>
    </div>

    <aside class="side" aria-label="Side panel">
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Document</strong>
          <button class="tb-btn" id="newTabBtn">+ New</button>
        </div>

        <div class="control-row">
          <label class="small">Title</label>
          <input id="titleInput" class="input" placeholder="Tab title" style="flex:1" />
        </div>

        <div class="control-row">
          <label class="small">Font</label>
          <select id="fontSelect" class="select" style="flex:1">
            <option value="">Default</option>
            <option value="Arial, sans-serif">Arial</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="'Courier New', monospace">Courier</option>
            <option value="Inter, system-ui">Inter</option>
          </select>
        </div>

        <div class="control-row">
          <label class="small">Size</label>
          <select id="sizeSelect" class="select">
            <option value="14px">14</option>
            <option value="16px" selected>16</option>
            <option value="18px">18</option>
            <option value="20px">20</option>
            <option value="24px">24</option>
          </select>
        </div>

        <hr />

        <div style="margin-top:8px">
          <div class="small">Storage</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="tb-btn" id="exportBtn">‚¨áÔ∏è Export</button>
            <button class="tb-btn" id="importBtn">‚¨ÜÔ∏è Import</button>
          </div>
          <div class="small" style="margin-top:8px">Saved: <span id="lastSaved">never</span></div>
        </div>
      </div>
    </aside>
  </div>

  <footer>
    <div class="small">Rich Editor ‚Äî Local-first notes</div>
    <div class="small">Tabs: <span id="tabCount">0</span></div>
  </footer>
</div>

<!-- inline minimal LZ-String (compress/decompress) - small footprint -->
<script>
/* Minimal LZString-like encoding using base64 of UTF-8 string.
   This is portable and small; it does reasonable compression via built-in methods.
   If you want stronger compression replace with full lz-string library. */
const MiniCompress = {
  compress: function(str){
    try { return btoa(unescape(encodeURIComponent(str))); } catch(e) { return str; }
  },
  decompress: function(comp){
    try { return decodeURIComponent(escape(atob(comp))); } catch(e) { return comp; }
  }
};
</script>

<script>
/* State and utilities */
const STORAGE_KEY = 'rich_editor_v1_comp';
let state = { tabs: [], activeId: null, lastSaved: null };
let saveTimer = null;

function nowIso(){ return new Date().toISOString(); }
function makeTab(title='Untitled'){ return { id: 't'+Date.now()+Math.floor(Math.random()*999), title, content:'', font:'', size:'16px' }; }
function getActiveTab(){ return state.tabs.find(t=>t.id === state.activeId); }
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }

/* --- Rendering --- */
function renderTabs(){
  const bar = document.getElementById('tabsBar');
  bar.innerHTML = '';
  state.tabs.forEach(t=>{
    const el = document.createElement('div');
    el.className = 'tab' + (t.id === state.activeId ? ' active' : '');
    el.setAttribute('role','tab');
    el.onclick = ()=> switchTab(t.id);
    el.innerHTML = `<span style="max-width:160px;overflow:hidden;text-overflow:ellipsis;display:inline-block">${escapeHtml(t.title)}</span>`;
    const close = document.createElement('button');
    close.className = 'close';
    close.textContent = '‚úï';
    close.title = 'Close tab';
    close.style.marginLeft='8px';
    close.onclick = (ev)=>{ ev.stopPropagation(); closeTab(t.id) };
    el.appendChild(close);
    el.ondblclick = (ev) => {
      ev.stopPropagation();
      const newTitle = prompt('Rename tab', t.title);
      if(newTitle !== null){ t.title = newTitle.trim() || t.title; renderTabs(); scheduleAutoSave(); }
    };
    bar.appendChild(el);
  });
  document.getElementById('tabCount').textContent = state.tabs.length;
}

function renderEditor(){
  const editor = document.getElementById('editor');
  const tab = getActiveTab();
  if(!tab) return;
  editor.innerHTML = tab.content || '<p><em>Start typing...</em></p>';
  document.getElementById('titleInput').value = tab.title;
  document.getElementById('fontSelect').value = tab.font || '';
  document.getElementById('sizeSelect').value = tab.size || '16px';
  applyFont(tab.font || '', false);
  applyFontSize(tab.size || '16px', false);
}

function renderAll(){ renderTabs(); renderEditor(); updateLastSavedDisplay(); }

/* --- Tabs --- */
function addTab(title){
  const t = makeTab(title || ('Note '+(state.tabs.length+1)));
  state.tabs.push(t);
  state.activeId = t.id;
  renderAll();
  scheduleAutoSave();
}
function switchTab(id){
  const cur = getActiveTab();
  if(cur){ cur.content = document.getElementById('editor').innerHTML; }
  state.activeId = id;
  renderAll();
}
function closeTab(id){
  if(!confirm('Close this tab? Unsaved changes in it will be lost (you can save first).')) return;
  state.tabs = state.tabs.filter(t=>t.id !== id);
  if(state.tabs.length === 0){ const t = makeTab('Untitled'); state.tabs.push(t); state.activeId = t.id; }
  if(state.activeId === id){ state.activeId = state.tabs[0].id; }
  renderAll();
  scheduleAutoSave();
}

/* --- Formatting & editing --- */
function execCmd(cmd, val=null){
  document.execCommand(cmd, false, val);
  const t = getActiveTab();
  if(t){ t.content = document.getElementById('editor').innerHTML; scheduleAutoSave(); }
}
function applyColor(hex){
  // foreColor works for many browsers; ensure hex is provided
  document.execCommand('foreColor', false, hex);
  const t = getActiveTab(); if(t){ t.content = document.getElementById('editor').innerHTML; scheduleAutoSave(); }
}
function applyBgColor(hex){
  // use hiliteColor for background highlight in many browsers
  document.execCommand('hiliteColor', false, hex);
  const t = getActiveTab(); if(t){ t.content = document.getElementById('editor').innerHTML; scheduleAutoSave(); }
}
function applyFont(font, save=true){ document.execCommand('fontName', false, font || ''); const t=getActiveTab(); if(t && save){ t.font = font; scheduleAutoSave(); } }
function applyFontSize(size, save=true){
  document.execCommand('fontSize', false, 7);
  const editor = document.getElementById('editor');
  const el = editor.querySelector('font[size="7"]');
  if(el){ el.removeAttribute('size'); el.style.fontSize = size; }
  const t = getActiveTab(); if(t && save){ t.size = size; scheduleAutoSave(); }
}

/* insert HTML at caret */
function execInsertHtml(html){
  const sel = window.getSelection();
  if(sel && sel.rangeCount){
    const range = sel.getRangeAt(0);
    range.deleteContents();
    const frag = range.createContextualFragment(html);
    range.insertNode(frag);
    // move caret after inserted node:
    range.setStartAfter(frag.lastChild || frag);
    range.collapse(true);
    sel.removeAllRanges(); sel.addRange(range);
  } else {
    const editor = document.getElementById('editor');
    editor.insertAdjacentHTML('beforeend', html);
  }
  const t=getActiveTab(); if(t){ t.content=document.getElementById('editor').innerHTML; scheduleAutoSave(); }
}

/* insert table prompt */
function insertTablePrompt(){
  const rowsRaw = prompt('Rows', '3');
  const colsRaw = prompt('Columns', '3');
  const rows = parseInt(rowsRaw,10);
  const cols = parseInt(colsRaw,10);
  if(isNaN(rows) || isNaN(cols) || rows < 1 || cols < 1){ alert('Invalid rows or columns'); return; }
  let html = '<table style="border-collapse:collapse;width:100%">';
  for(let r=0;r<rows;r++){
    html += '<tr>';
    for(let c=0;c<cols;c++){
      html += `<td contenteditable="true" style="border:1px solid #ccc;padding:8px"> </td>`;
    }
    html += '</tr>';
  }
  html += '</table><p></p>';
  execInsertHtml(html);
}

/* image handling */
function handleLocalImageFile(file){
  if(!file) return;
  if(!file.type.startsWith('image/')) { alert('Select an image file'); return; }
  const reader = new FileReader();
  reader.onload = function(evt){
    const dataUrl = evt.target.result;
    const imgHtml = `<img src="${dataUrl}" style="max-width:100%;height:auto;border-radius:6px" />`;
    execInsertHtml(imgHtml);
  };
  reader.readAsDataURL(file);
}

/* --- Persistence: compress + save --- */
function saveAll(){
  const payload = {
    tabs: state.tabs,
    activeId: state.activeId,
    lastSaved: nowIso()
  };
  try{
    const json = JSON.stringify(payload);
    const compressed = MiniCompress.compress(json);
    localStorage.setItem(STORAGE_KEY, compressed);
    state.lastSaved = payload.lastSaved;
    updateLastSavedDisplay();
    // silent save
  }catch(e){ console.error('Save failed', e); }
}

function loadAllFromStorage(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return false;
  try{
    const json = MiniCompress.decompress(raw);
    const parsed = JSON.parse(json);
    if(parsed && parsed.tabs && Array.isArray(parsed.tabs) && parsed.tabs.length){
      state.tabs = parsed.tabs;
      state.activeId = parsed.activeId || (state.tabs[0] && state.tabs[0].id);
      state.lastSaved = parsed.lastSaved || state.lastSaved;
      return true;
    }
    return false;
  }catch(e){ console.warn('Failed to load saved state', e); return false; }
}

function clearAll(){
  if(!confirm('Clear all saved notes from localStorage? This cannot be undone.')) return;
  localStorage.removeItem(STORAGE_KEY);
  state = { tabs: [ makeTab('Untitled') ], activeId: null, lastSaved: null };
  state.activeId = state.tabs[0].id;
  renderAll();
}

/* Import / Export */
function exportAll(){
  const payload = { tabs: state.tabs, activeId: state.activeId, lastSaved: state.lastSaved };
  const blob = new Blob([JSON.stringify(payload, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'rich-editor-backup.json';
  a.click();
  URL.revokeObjectURL(a.href);
}
function importAll(){
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'application/json';
  input.onchange = (ev) => {
    const f = ev.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = (evt)=> {
      try{
        const parsed = JSON.parse(evt.target.result);
        if(parsed.tabs && Array.isArray(parsed.tabs)){
          state.tabs = parsed.tabs;
          state.activeId = parsed.activeId || (state.tabs[0] && state.tabs[0].id);
          saveAll();
          renderAll();
          alert('Imported successfully.');
        } else alert('Invalid file format.');
      }catch(e){ alert('Import failed: '+e.message) }
    };
    reader.readAsText(f);
  };
  input.click();
}

/* --- Autosave scheduling (silent) --- */
function scheduleAutoSave(){
  clearTimeout(saveTimer);
  saveTimer = setTimeout(()=>{ saveAll(); }, 2000);
}

/* --- UI wiring & initialization --- */
function updateLastSavedDisplay(){
  document.getElementById('lastSaved').textContent = state.lastSaved ? new Date(state.lastSaved).toLocaleString() : 'never';
}

/* attach events and init */
(function init(){
  // load state
  const loaded = loadAllFromStorage();
  if(!loaded){
    const t = makeTab('Untitled');
    state.tabs = [t];
    state.activeId = t.id;
  }
  if(!state.activeId && state.tabs.length) state.activeId = state.tabs[0].id;

  // render
  renderAll();

  // wire editor input
  const editor = document.getElementById('editor');
  editor.addEventListener('input', ()=> {
    const tab = getActiveTab();
    if(tab){ tab.content = editor.innerHTML; scheduleAutoSave(); }
  });

  // toolbar buttons
  document.getElementById('boldBtn').addEventListener('click', ()=> execCmd('bold'));
  document.getElementById('italicBtn').addEventListener('click', ()=> execCmd('italic'));
  document.getElementById('underlineBtn').addEventListener('click', ()=> execCmd('underline'));
  document.getElementById('strikeBtn').addEventListener('click', ()=> execCmd('strikeThrough'));
  document.getElementById('bulletedBtn').addEventListener('click', ()=> execCmd('insertUnorderedList'));
  document.getElementById('numberedBtn').addEventListener('click', ()=> execCmd('insertOrderedList'));
  document.getElementById('imgBtn').addEventListener('click', ()=> document.getElementById('imgInput').click());
  document.getElementById('imgInput').addEventListener('change', (e)=> handleLocalImageFile(e.target.files[0]));
  document.getElementById('tableBtn').addEventListener('click', insertTablePrompt);

  // color pickers
  document.getElementById('colorPicker').addEventListener('input', (e)=> applyColor(e.target.value));
  document.getElementById('bgColorPicker').addEventListener('input', (e)=> applyBgColor(e.target.value));

  // side controls
  document.getElementById('newTabBtn').addEventListener('click', ()=> addTab());
  document.getElementById('titleInput').addEventListener('input', (e)=> {
    const t = getActiveTab();
    if(t){ t.title = e.target.value; renderTabs(); scheduleAutoSave(); }
  });
  document.getElementById('fontSelect').addEventListener('change', (e)=> applyFont(e.target.value));
  document.getElementById('sizeSelect').addEventListener('change', (e)=> applyFontSize(e.target.value));

  document.getElementById('saveBtn').addEventListener('click', ()=> { saveAll(); alert('Saved.'); });
  document.getElementById('clearBtn').addEventListener('click', clearAll);
  document.getElementById('exportBtn').addEventListener('click', exportAll);
  document.getElementById('importBtn').addEventListener('click', importAll);

  // keyboard shortcuts: Ctrl/Cmd+B/I/U
  document.addEventListener('keydown', (e)=> {
    if((e.ctrlKey||e.metaKey) && !e.shiftKey){
      const k = e.key.toLowerCase();
      if(k==='b'){ e.preventDefault(); execCmd('bold'); }
      if(k==='i'){ e.preventDefault(); execCmd('italic'); }
      if(k==='u'){ e.preventDefault(); execCmd('underline'); }
    }
  });

  // final render
  renderAll();
})();
</script>
</body>
</html>

.
